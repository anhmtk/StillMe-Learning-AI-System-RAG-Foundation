# AgentDev Tool Allowlist Policy
# Defines which tools are allowed and their valid parameters

version: "1.0"
updated_at: "2025-09-23"

# Tool categories
tool_categories:
  read_only:
    description: "Tools that only read data"
    risk_level: "low"
    requires_approval: false
  
  write_safe:
    description: "Tools that write but with safety checks"
    risk_level: "medium"
    requires_approval: false
  
  system_dangerous:
    description: "Tools that can modify system or run commands"
    risk_level: "high"
    requires_approval: true

# Allowed tools
allowed_tools:
  # File operations (read-only)
  read_file:
    category: "read_only"
    description: "Read file contents"
    valid_parameters:
      target_file:
        type: "string"
        required: true
        pattern: "^[a-zA-Z0-9_./\\-]+$"
        max_length: 500
      limit:
        type: "integer"
        required: false
        min: 1
        max: 10000
      offset:
        type: "integer"
        required: false
        min: 0
    
  list_dir:
    category: "read_only"
    description: "List directory contents"
    valid_parameters:
      target_directory:
        type: "string"
        required: true
        pattern: "^[a-zA-Z0-9_./\\-]+$"
        max_length: 500
      ignore_globs:
        type: "array"
        required: false
        max_items: 20
  
  grep:
    category: "read_only"
    description: "Search for patterns in files"
    valid_parameters:
      pattern:
        type: "string"
        required: true
        max_length: 1000
      path:
        type: "string"
        required: false
        pattern: "^[a-zA-Z0-9_./\\-]+$"
        max_length: 500
      
  # File operations (write-safe)
  write:
    category: "write_safe"
    description: "Write file contents"
    valid_parameters:
      file_path:
        type: "string"
        required: true
        pattern: "^[a-zA-Z0-9_./\\-]+$"
        max_length: 500
        blacklist:
          - "/etc/"
          - "/usr/"
          - "/bin/"
          - "/sbin/"
          - "C:\\Windows\\"
          - "C:\\Program Files\\"
      contents:
        type: "string"
        required: true
        max_length: 1000000  # 1MB max
  
  search_replace:
    category: "write_safe"
    description: "Search and replace in files"
    valid_parameters:
      file_path:
        type: "string"
        required: true
        pattern: "^[a-zA-Z0-9_./\\-]+$"
        max_length: 500
      old_string:
        type: "string"
        required: true
        max_length: 10000
      new_string:
        type: "string"
        required: true
        max_length: 10000
  
  # System operations (dangerous)
  run_terminal_cmd:
    category: "system_dangerous"
    description: "Execute terminal commands"
    valid_parameters:
      command:
        type: "string"
        required: true
        max_length: 1000
        # Blacklist dangerous commands
        blacklist:
          - "rm -rf"
          - "del /s"
          - "format"
          - "fdisk"
          - "dd if="
          - "chmod 777"
          - "sudo su"
          - "passwd"
          - "useradd"
          - "userdel"
      is_background:
        type: "boolean"
        required: true

# Blocked tools (never allowed)
blocked_tools:
  - delete_file  # Too dangerous without proper checks
  - web_search   # Must go through controlled channels
  - fetch_rules  # Should use policy engine instead

# Parameter sanitization rules
sanitization:
  path_normalization: true
  remove_null_bytes: true
  unicode_normalization: true
  max_depth_traversal: 10  # Prevent ../../../ attacks

# Approval workflow
approval_workflow:
  enabled: true
  timeout_seconds: 300  # 5 minutes for manual approval
  auto_approve_categories:
    - "read_only"
    - "write_safe"
  manual_approve_categories:
    - "system_dangerous"
