# AgentDev Network Allowlist Policy
# Defines allowed domains, schemes, and security constraints for network access

version: "1.0"
updated_at: "2025-09-23"

# Allowed URL schemes
allowed_schemes:
  - "https"
  # Note: http is intentionally excluded for security

# Allowed domains (allowlist approach)
allowed_domains:
  # Development and testing
  - "httpbin.org"
  - "jsonplaceholder.typicode.com"
  - "postman-echo.com"
  
  # Code repositories and documentation
  - "github.com"
  - "*.github.com"
  - "raw.githubusercontent.com"
  - "api.github.com"
  - "docs.github.com"
  
  # Package managers and registries
  - "pypi.org"
  - "*.pypi.org"
  - "registry.npmjs.org"
  - "registry.npmjs.com"
  - "crates.io"
  - "*.crates.io"
  
  # Documentation sites
  - "stackoverflow.com"
  - "*.stackoverflow.com"
  - "docs.python.org"
  - "docs.rs"
  - "developer.mozilla.org"
  - "*.readthedocs.io"
  
  # AI and ML services (if needed)
  - "api.openai.com"
  - "api.anthropic.com"
  - "huggingface.co"
  - "*.huggingface.co"
  
  # Cloud services (specific endpoints only)
  - "api.github.com"
  - "releases.ubuntu.com"
  
  # News and information (limited)
  - "news.ycombinator.com"

# Explicitly blocked domains (takes precedence over allowlist)
blocked_domains:
  # Local and private networks
  - "localhost"
  - "*.local"
  - "*.internal"
  - "*.corp"
  - "*.intranet"
  
  # Cloud metadata endpoints
  - "metadata.google.internal"
  - "169.254.169.254"
  - "100.100.100.200"  # Alibaba Cloud
  
  # Known malicious categories
  - "*.onion"
  - "*.bit"
  - "*.i2p"

# Blocked IP ranges (CIDR notation)
blocked_ips:
  # Private networks (RFC 1918)
  - "10.0.0.0/8"
  - "172.16.0.0/12"
  - "192.168.0.0/16"
  
  # Localhost and loopback
  - "127.0.0.0/8"
  - "::1/128"
  
  # Link-local
  - "169.254.0.0/16"
  - "fe80::/10"
  
  # Cloud metadata
  - "169.254.169.254/32"

# Content and size limits
content_limits:
  max_size_mb: 10  # Maximum response size
  max_url_length: 2000  # Maximum URL length
  max_redirects: 3  # Maximum number of redirects to follow
  timeout_seconds: 30  # Request timeout

# Rate limiting
rate_limit:
  requests_per_second: 10.0  # Base rate limit
  burst_size: 20  # Burst capacity
  per_user_limit: true  # Apply rate limiting per user
  cooldown_on_block: 60  # Cooldown period after being blocked (seconds)

# Content filtering
content_filtering:
  enabled: true
  max_response_scan_kb: 100  # Only scan first 100KB for performance
  
  # Block responses containing these patterns
  blocked_patterns:
    - "BEGIN PRIVATE KEY"
    - "BEGIN RSA PRIVATE KEY" 
    - "AWS_SECRET_ACCESS_KEY"
    - "SECRET_KEY"
    - "password\\s*[=:]"
    - "token\\s*[=:].*[a-zA-Z0-9]{20,}"
    
  # Block responses with these MIME types
  blocked_mime_types:
    - "application/x-executable"
    - "application/x-msdownload"
    - "application/x-msdos-program"

# Security headers enforcement
security_headers:
  user_agent: "AgentDev-NetworkGuard/1.0"
  
  # Always add these headers to requests
  default_headers:
    "Accept": "application/json, text/plain, */*"
    "Accept-Language": "en-US,en;q=0.9"
    "Cache-Control": "no-cache"
    "DNT": "1"
  
  # Validate these headers in responses
  required_response_headers:
    - "Content-Type"
  
  # Block responses missing security headers (optional)
  warn_missing_security_headers:
    - "X-Content-Type-Options"
    - "X-Frame-Options"
    - "X-XSS-Protection"

# Logging and monitoring
logging:
  log_all_requests: true
  log_blocked_requests: true
  log_response_headers: false  # Privacy consideration
  log_response_body: false  # Privacy consideration
  
  # Retention
  max_log_entries: 1000
  log_rotation_days: 7

# Emergency controls
emergency:
  # Kill switch - blocks ALL network access if true
  block_all_network: false
  
  # Temporary domain blocking
  temp_blocked_domains: []
  
  # Override allowlist (for emergency situations)
  emergency_allowlist_only: []

# Network policy validation
validation:
  # Require domains to be explicitly allowed
  require_explicit_allowlist: true
  
  # Block requests to IP addresses (require domain names)
  block_ip_requests: true
  
  # Block non-standard ports
  allowed_ports:
    - 80   # HTTP (if somehow needed)
    - 443  # HTTPS
    - 8080 # Common alternative HTTP port
    - 8443 # Common alternative HTTPS port
  
  # Domain validation
  min_domain_length: 4
  max_domain_length: 253
  require_tld: true

# Compliance and audit
compliance:
  # Log all policy violations for audit
  audit_violations: true
  
  # Require reason for manual overrides
  require_override_reason: true
  
  # Policy enforcement level
  enforcement_level: "strict"  # strict, warn, disabled
