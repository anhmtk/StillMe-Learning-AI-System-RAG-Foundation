# StillMe Mobile App Makefile

.PHONY: help install clean build run test apk release

# Default target
help:
	@echo "StillMe Mobile App - Available commands:"
	@echo ""
	@echo "  install     - Install Flutter dependencies"
	@echo "  clean       - Clean build artifacts"
	@echo "  build       - Build the app"
	@echo "  run         - Run on connected device/emulator"
	@echo "  test        - Run tests"
	@echo "  apk         - Build APK (debug)"
	@echo "  release     - Build release APK (unsigned)"
	@echo "  doctor      - Run Flutter doctor"
	@echo "  format      - Format code"
	@echo "  analyze     - Analyze code"
	@echo ""

# Install dependencies
install:
	@echo "ğŸ“¦ Installing Flutter dependencies..."
	flutter pub get
	@echo "âœ… Dependencies installed!"

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	flutter clean
	flutter pub get
	@echo "âœ… Clean completed!"

# Build the app
build:
	@echo "ğŸ”¨ Building StillMe Mobile App..."
	flutter build apk --debug
	@echo "âœ… Build completed!"

# Run on device/emulator
run:
	@echo "ğŸš€ Running StillMe Mobile App..."
	flutter run --debug
	@echo "âœ… App running!"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	flutter test
	@echo "âœ… Tests completed!"

# Build debug APK
apk:
	@echo "ğŸ“± Building debug APK..."
	flutter build apk --debug
	@echo "âœ… APK built: build/app/outputs/flutter-apk/app-debug.apk"

# Build release APK (unsigned)
release:
	@echo "ğŸ“± Building release APK (unsigned)..."
	flutter build apk --release
	@echo "âœ… Release APK built: build/app/outputs/flutter-apk/app-release.apk"

# Run Flutter doctor
doctor:
	@echo "ğŸ©º Running Flutter doctor..."
	flutter doctor
	@echo "âœ… Flutter doctor completed!"

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	flutter format .
	@echo "âœ… Code formatted!"

# Analyze code
analyze:
	@echo "ğŸ” Analyzing code..."
	flutter analyze
	@echo "âœ… Code analysis completed!"

# Generate code (for freezed, json_serializable, etc.)
generate:
	@echo "âš¡ Generating code..."
	flutter packages pub run build_runner build --delete-conflicting-outputs
	@echo "âœ… Code generation completed!"

# Build with custom base URL
build-with-url:
	@echo "ğŸ”¨ Building with custom base URL..."
	flutter build apk --debug --dart-define=BASE_URL=http://160.191.89.99:21568
	@echo "âœ… Build with custom URL completed!"

# Build with founder mode enabled
build-founder:
	@echo "ğŸ”¨ Building with founder mode enabled..."
	flutter build apk --debug --dart-define=FOUNDER_MODE=true
	@echo "âœ… Build with founder mode completed!"

# Build with custom passcode
build-passcode:
	@echo "ğŸ”¨ Building with custom passcode..."
	flutter build apk --debug --dart-define=FOUNDER_PASSCODE=1234
	@echo "âœ… Build with custom passcode completed!"

# Full build with all custom settings
build-full:
	@echo "ğŸ”¨ Building with all custom settings..."
	flutter build apk --debug \
		--dart-define=BASE_URL=http://160.191.89.99:21568 \
		--dart-define=FOUNDER_MODE=true \
		--dart-define=FOUNDER_PASSCODE=0000
	@echo "âœ… Full build completed!"

# Install APK on connected device
install-apk:
	@echo "ğŸ“± Installing APK on connected device..."
	adb install build/app/outputs/flutter-apk/app-debug.apk
	@echo "âœ… APK installed!"

# Check connected devices
devices:
	@echo "ğŸ“± Checking connected devices..."
	flutter devices
	@echo "âœ… Device check completed!"

# Run on specific device
run-device:
	@echo "ğŸš€ Running on specific device..."
	flutter run --device-id=$(DEVICE_ID)
	@echo "âœ… App running on device!"

# Build and install in one command
build-install:
	@echo "ğŸ”¨ Building and installing APK..."
	$(MAKE) apk
	$(MAKE) install-apk
	@echo "âœ… Build and install completed!"

# Development workflow
dev: clean install generate run

# Production workflow
prod: clean install generate build-full

# Quick test
quick-test:
	@echo "âš¡ Quick test..."
	flutter test test/
	@echo "âœ… Quick test completed!"

# Full test suite
full-test:
	@echo "ğŸ§ª Full test suite..."
	flutter test
	flutter analyze
	flutter format --set-exit-if-changed .
	@echo "âœ… Full test suite completed!"
