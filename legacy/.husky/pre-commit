#!/usr/bin/env bash
set -e

echo "üîç Running pre-commit checks..."

# Check for .env files in staged changes
if git diff --cached --name-only | grep -qE '^\.env($|\.|$)'; then
  echo "‚ùå C·∫•m commit .env. D√πng .env.example."
  exit 1
fi

# Run linting
echo "üîç Running Python linting..."
if command -v ruff &> /dev/null; then
  ruff check . --fix
else
  echo "‚ö†Ô∏è ruff not found, skipping linting"
fi

# Run formatting
echo "üîç Running code formatting..."
if command -v black &> /dev/null; then
  black . --check
else
  echo "‚ö†Ô∏è black not found, skipping formatting"
fi

# Check for secrets
echo "üîç Checking for secrets..."
if command -v gitleaks &> /dev/null; then
  gitleaks protect --staged
else
  echo "‚ö†Ô∏è gitleaks not found, skipping secret scan"
fi

echo "‚úÖ Pre-commit checks passed!"