# Upstream configuration for StillMe Gateway POC

# Gateway backend with load balancing and health checks
upstream gateway_backend {
    # Load balancing method
    least_conn;
    
    # Backend servers
    server gateway:8000 max_fails=3 fail_timeout=30s;
    server gateway:8001 backup;
    
    # Health check
    keepalive 32;
    keepalive_requests 1000;
    keepalive_timeout 60s;
}

# AI backend with load balancing
upstream ai_backend {
    # Load balancing method
    ip_hash;  # Sticky sessions for AI requests
    
    # Backend servers
    server ai-server:1216 max_fails=3 fail_timeout=30s;
    
    # Health check
    keepalive 16;
    keepalive_requests 500;
    keepalive_timeout 60s;
}

# Redis upstream for caching
upstream redis_backend {
    server redis:6379;
    keepalive 8;
}

# Database upstream (if using external DB)
upstream database_backend {
    server postgres:5432;
    keepalive 4;
}
