# StillMe â€” Engineering Guardrails & Execution Rules
# This file is loaded every session by Cursor.

## EXECUTION CONTROL
- Khi mÃ¬nh báº¥m "Skip", Ä‘á»«ng coi lÃ  há»§y lá»‡nh. HÃ£y dá»«ng chá», Ä‘á»c log terminal má»›i nháº¥t, tÃ³m táº¯t tÃ¬nh hÃ¬nh vÃ  tiáº¿p tá»¥c bÆ°á»›c tiáº¿p theo.

## SECURITY (CLIENT/MOBILE)
- Tuyá»‡t Ä‘á»‘i khÃ´ng táº¡o hoáº·c Ä‘á»c .env trÃªn mobile. KhÃ´ng dÃ¹ng flutter_dotenv.
- KhÃ´ng embed API keys, token, secrets trong code, asset, dart-define, Gradle, Manifest, hoáº·c trong APK/IPA.
- Mobile config chá»‰ chá»©a giÃ¡ trá»‹ khÃ´ng nháº¡y cáº£m (public base URL, timeout, feature flag, theme).
- Secrets chá»‰ tá»“n táº¡i á»Ÿ VPS gateway.
- Build release:
  - Táº¯t toÃ n bá»™ log request/response.
  - Báº¯t buá»™c HTTPS, khÃ´ng cho cleartext.
  - Báº­t minify + obfuscate.

## NETWORKING
- Kiáº¿n trÃºc: Mobile â†’ VPS Gateway (giá»¯ keys) â†’ LLM Providers.
- Auth: dÃ¹ng session token ngáº¯n háº¡n (X-Session). CÃ³ thá»ƒ thÃªm request signing (HMAC) vá»›i secret chá»‰ á»Ÿ server.

## CLEAN REPO & CI
- KhÃ´ng commit .env, keystore, build artifact.
- LuÃ´n quÃ©t secret trÆ°á»›c commit/push (gitleaks).
- Commit theo Conventional Commits.

## ACCEPTANCE KHI Äá»¤NG /chat
- Cáº§n cÃ³ (1) screenshot UI, (2) raw JSON (Ä‘Ã£ áº©n nháº¡y cáº£m), (3) giáº£i thÃ­ch adapter, (4) chá»©ng minh khÃ´ng dÃ¹ng placeholder.

## MOBILE RELEASE SECURITY RULES

# Má»¥c tiÃªu: Ä‘áº£m báº£o báº£n phÃ¡t hÃ nh (APK/IPA â€“ flavor prod) khÃ´ng chá»©a placeholder, khÃ´ng log nháº¡y cáº£m, vÃ  hoÃ n toÃ n khÃ´ng cÃ³ API keys/secrets á»Ÿ client.

- Networking (prod):
  - HTTPS-only. KhÃ´ng cho phÃ©p cleartext. KhÃ´ng dÃ¹ng networkSecurityConfig cho prod.
  - KhÃ´ng dÃ¹ng IP hard-code trong prod; dÃ¹ng domain. (Dev cÃ³ thá»ƒ dÃ¹ng IP.)
- Logging:
  - Táº¯t toÃ n bá»™ HTTP/Dio logging á»Ÿ prod (request/response/body/headers).
  - Táº¯t má»i debug banner/verbose logs trong prod.
- Placeholders & mocks:
  - Cáº¥m hiá»ƒn thá»‹ placeholder hoáº·c mock khi status=200.
  - Náº¿u detect model/flag lÃ  "placeholder|mock", FAIL nhiá»‡m vá»¥ phÃ¡t hÃ nh vÃ  thÃ´ng bÃ¡o rÃµ: "Placeholder detected â€“ not a real LLM."
- Secrets:
  - TUYá»†T Äá»I khÃ´ng cÃ³ API keys/secrets/tokens trong:
    - source code, assets, dart-define, Gradle, Manifest, keystore, APK/IPA.
  - KhÃ´ng táº¡o/Ä‘á»c `.env` phÃ­a mobile. KhÃ´ng dÃ¹ng `flutter_dotenv`.
  - Secrets chá»‰ tá»“n táº¡i vÃ  Ä‘Æ°á»£c dÃ¹ng á»Ÿ VPS Gateway.
- Config theo flavor:
  - Dev: cho phÃ©p HTTP + log Ä‘á»ƒ debug.
  - Prod: HTTPS-only, no logs, minify+obfuscate báº­t.
- Pre-release checklist (báº¯t buá»™c tá»± kiá»ƒm tra trÆ°á»›c khi build release):
  1) Táº¯t Dio logs, debug banners, mock/placeholder flags.
  2) BASE_URL lÃ  HTTPS domain (khÃ´ng pháº£i IP) cho prod.
  3) Gitleaks scan PASS; khÃ´ng cÃ³ file `.env`, *.keystore, *.pem, secrets trong git.
  4) Adapter nháº­n Ä‘Ãºng field cá»§a gateway (`response|text|output|choices[0].text`); khÃ´ng fallback placeholder khi 200.
  5) Build release kÃ¨m obfuscation vÃ  shrinkResources (Android).
- Acceptance khi phÃ¡t hÃ nh:
  - ÄÃ­nh kÃ¨m áº£nh UI + raw JSON (Ä‘Ã£ áº©n nháº¡y cáº£m) chá»©ng minh lÃ  cÃ¢u tráº£ lá»i LLM tháº­t, model â‰  placeholder.
  - In Ä‘Æ°á»ng dáº«n artifact (APK/AAB/IPA) vÃ  metadata build (flavor, build time, package id).

## DEVELOPER EXPERIENCE (DX) RULES

# Skip button protocol
- Khi ngÆ°á»i dÃ¹ng báº¥m "Skip", KHÃ”NG coi lÃ  há»§y.
  1) Äá»c log terminal má»›i nháº¥t.
  2) TÃ³m táº¯t tráº¡ng thÃ¡i (success/fail/Ä‘ang chá»).
  3) Tiáº¿p tá»¥c flow tá»« bÆ°á»›c há»£p lÃ½, khÃ´ng reset.

# Build & test errors
- Khi build/test/deploy tháº¥t báº¡i:
  1) Parse log Ä‘á»ƒ tÃ¬m root cause.
  2) Äá» xuáº¥t fix ngáº¯n gá»n ngay trong output.
  3) Náº¿u nhiá»u lá»—i, liá»‡t kÃª top 3 critical theo thá»© tá»± Æ°u tiÃªn.

# Long-running tasks
- Náº¿u task > 30s, hiá»ƒn thá»‹ tráº¡ng thÃ¡i Ä‘á»‹nh ká»³ (progress).
- Náº¿u log cÃ³ váº» treo, nháº¯c ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ báº¥m Skip Ä‘á»ƒ tiáº¿p tá»¥c.

# Logs
- Highlight cÃ¡c dÃ²ng ERROR/FAIL/WARNING.
- Vá»›i log dÃ i, tá»± tÃ³m táº¯t pháº§n cuá»‘i (â‰ˆ50 dÃ²ng) vÃ  nÃªu lá»—i chÃ­nh.

# Commits
- DÃ¹ng Conventional Commits. 
- Thay Ä‘á»•i báº£o máº­t prefix: `chore(security): â€¦`.

# Documentation
- Sau má»—i thay Ä‘á»•i quan trá»ng (build config, security, CI), cáº­p nháº­t README.md hoáº·c docs/*.
- Náº¿u chÆ°a cáº­p nháº­t, tá»± thÃªm To-do "Update README.md".

# Build outputs
- Khi build mobile/desktop xong, in rÃµ:
  - ğŸ“± Ä‘Æ°á»ng dáº«n artifact
  - ğŸ”‘ ghi chÃº kÃ½ (náº¿u cáº§n)
  - ğŸ debug: log Ä‘ang báº­t
  - ğŸ”’ release: xÃ¡c nháº­n Ä‘Ã£ táº¯t log nháº¡y cáº£m

# End of rules.
